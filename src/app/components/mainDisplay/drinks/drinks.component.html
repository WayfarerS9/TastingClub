<app-main-header></app-main-header>
<div class="main">
  <div class="for-go-back-button">
    <button class="go-back-button" mat-fab (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
  </div>

  <div class="container-header">
    <h2>My Drinks</h2>
  </div>

  <div class="sub-container">
    <div class="container-left-side">
      <!-- <h3 *ngIf="!isAdd">Type the name of the drink</h3> -->
      <div *ngIf="!isAdd" class="list">
        <p *ngFor="let drink of myTastedDrinks; let i = index">
          <mat-card class="example-card">
            <div class="container-image">
              <img mat-card-image [src]="drink.image" />
            </div>
            <div class="container-for-drink-info">
              <div class="container-for-drink-name">
                <mat-card-title>
                  {{ drink.name }}
                </mat-card-title>
              </div>
              <div class="container-for-drink-type">
                <mat-card-subtitle>{{ drink.type }}</mat-card-subtitle>
              </div>

              <div class="container-for-drink-rating">
                <mat-card-subtitle>
                  <div>
                    <ngb-rating
                      [max]="5"
                      class="rating"
                      [rate]="drink.rating"
                      [readonly]="true"
                    ></ngb-rating>
                  </div>
                </mat-card-subtitle>
              </div>
              <div class="container-for-feedback">
                <mat-card-content>
                  <textarea
                    class="textarea"
                    disabled
                    [(ngModel)]="drink.feedBack"
                  >
                  </textarea>
                  <div class="border"></div>
                </mat-card-content>
              </div>

              <button
                class="reviews"
                color="primary"
                (click)="selectAndGetDrink(drink)"
                (click)="onEdit()"
                (click)="triggerModal(modalData)"
              >
                See all reviews
              </button>
            </div>

            <div class="mat-menu-container">
              <button
                mat-icon-button
                [matMenuTriggerFor]="beforeMenu"
                (click)="matMenu($event)"
                color="primary"
              >
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #beforeMenu="matMenu" xPosition="before">
                <button mat-menu-item>
                  <button
                    (click)="delete($event, drink)"
                    class="menu-delete-button"
                  >
                    Delete
                  </button>
                </button>
              </mat-menu>

              <ng-template #modalData let-modal>
                <div class="description-about-drink">
                  <div>
                    {{ myTastedDrinkFullInfo?.name
                    }}<span class="type-of-drink">
                      ({{ myTastedDrinkFullInfo?.typeOfDrink }})</span
                    >
                  </div>
                </div>

                <div class="modal-body" *ngIf="!isAdd">
                  <div class="container-for-degustation">
                    <div>
                      Date of degustation:
                      <span>{{ tableResult?.dateOfDegustation }}</span>
                    </div>
                  </div>

                  <div class="container-for-rating">
                    <span>Rating</span>
                    <div>
                      <ngb-rating
                        [max]="5"
                        [readonly]="true"
                        [resettable]="true"
                        (rateChange)="onRateChange($event)"
                        [rate]="drink.rating"
                        class="rating"
                      ></ngb-rating>
                    </div>
                  </div>

                  <div class="container-for-feedback">
                    <span>Feed back</span>
                    <div>
                      <textarea
                        [(ngModel)]="drink.feedBack"
                        disabled
                      ></textarea>
                      <!-- <button
                        class="button-edit-check"
                        mat-raised-button
                        color="primary"
                        (click)="update()"
                        *ngIf="isEdit"
                      >
                        Save review
                      </button> -->
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    mat-stroked-button
                    color="primary"
                    class="close-window"
                    (click)="modal.close('Save click')"
                  >
                    Close
                  </button>
                </div>

                <button
                  mat-button
                  [matMenuTriggerFor]="beforeMenu"
                  class="modal-mat-menu"
                >
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu
                  #menu="matMenu"
                  #beforeMenu="matMenu"
                  xPosition="before"
                >
                  <button
                    mat-raised-button
                    class="menu-edit-button"
                    (click)="triggerModal(modalData)"
                  >
                    Edit
                    <ng-template #modalData let-modal>
                      <div class="modal-header">
                        <h2>Edit review</h2>
                      </div>
                      <div class="modal-body" *ngIf="!isAdd">
                        <div class="container-for-degustation">
                          <mat-form-field
                            appearance="outline"
                            class="example-form-field"
                          >
                            <mat-label>Choose a date</mat-label>
                            <input
                              matInput
                              [matDatepicker]="datepicker"
                              [min]="minDate"
                              [max]="maxDate"
                              (dateChange)="onChangeEvent($event)"
                            />
                            <mat-datepicker-toggle
                              matSuffix
                              [for]="datepicker"
                            ></mat-datepicker-toggle>
                            <mat-datepicker #datepicker>
                              <mat-datepicker-actions>
                                <button mat-button matDatepickerCancel>
                                  Cancel
                                </button>
                                <button
                                  mat-raised-button
                                  color="primary"
                                  matDatepickerApply
                                >
                                  Apply
                                </button>
                              </mat-datepicker-actions>
                            </mat-datepicker>
                          </mat-form-field>
                        </div>

                        <div class="container-for-rating">
                          <span>Rating</span>
                          <div>
                            <ngb-rating
                              [max]="5"
                              [readonly]="false"
                              [resettable]="false"
                              (rateChange)="onRateChange($event)"
                              [rate]="drink.rating"
                              class="rating"
                            ></ngb-rating>
                          </div>
                        </div>

                        <div class="container-for-feedback">
                          <span>Feed back</span>
                          <div>
                            <form #feedBackForm="ngForm">
                              <mat-form-field appearance="outline">
                                <mat-label>Leave a comment</mat-label>
                                <textarea
                                  matInput
                                  [(ngModel)]="addUpdateFeedBackModel.feedBack"
                                  rows="2"
                                  required
                                  [(ngModel)]="defaultValue"
                                >
                                </textarea>
                                <mat-error
                                  class="mat-error"
                                  *ngIf="!isAdd && isEdit"
                                >
                                  Field are empty, please entry feed back
                                </mat-error>
                              </mat-form-field>
                            </form>
                            <div class="two-buttons">
                              <div
                                class="cancel-button"
                                mat-raised-button
                                (click)="modal.close('Save click')"
                              >
                                Cancel
                              </div>
                              <div
                                class="save-button"
                                mat-raised-button
                                (click)="update(); modal.close('Save click')"
                                *ngIf="isEdit"
                              >
                                Save
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </ng-template>
                  </button>
                  <button mat-raised-button class="menu-delete-second-button">
                    Delete
                  </button>
                </mat-menu>
              </ng-template>
            </div>
          </mat-card>
        </p>
      </div>

      <button
        class="button-add"
        color="primary"
        mat-fab
        (click)="onAdd()"
        *ngIf="!isAdd || !isEdit"
        (click)="triggerModal(modalData)"
      >
        <mat-icon>add</mat-icon>
        <ng-template #modalData let-modal>
          <!-- <h3 *ngIf="!isAdd">Type the name of the drink</h3> -->
          <div class="findDrink" *ngIf="isAdd">
            <mat-form-field appearance="fill">
              <mat-label>Type the drink</mat-label>
              <input
                matInput
                placeholder="Search"
                (input)="searchDrinks($event)"
              />
            </mat-form-field>

            <div class="listOfFind">
              <span
                *ngFor="let drink of matchingDrinks; let i = index"
                class="item"
                (click)="selectAndGetDrink(drink)"
                [ngClass]="{ selectedItem: drink === selectedTastedDrink }"
              >
                {{ i + 1 }}. {{ drink.title }}
              </span>
            </div>
          </div>

          <div class="container-right-side" *ngIf="!isAdd">
            <div class="feedBack" *ngIf="!isAdd">
              <div class="infAboutDrink">
                <div
                  class="image-container"
                  *ngIf="myTastedDrinkFullInfo?.image"
                >
                  <img [src]="myTastedDrinkFullInfo?.image" alt="" />
                </div>
                <div
                  class="description-about-drink"
                  *ngIf="myTastedDrinkFullInfo?.image"
                >
                  <h3>
                    {{ myTastedDrinkFullInfo?.typeOfDrink }}
                    {{ myTastedDrinkFullInfo?.name }}
                  </h3>
                  <p>
                    <strong>Region:</strong> {{ myTastedDrinkFullInfo?.region }}
                  </p>
                  <p>
                    <strong>Manufacturer:</strong>
                    {{ myTastedDrinkFullInfo?.manufacturer }}
                  </p>

                  <p *ngIf="myTastedDrinkFullInfo?.category">
                    <strong>Category:</strong>
                    <span
                      *ngFor="let category of myTastedDrinkFullInfo?.category"
                    >
                      {{ category }}
                    </span>
                  </p>
                  <p *ngIf="myTastedDrinkFullInfo?.type">
                    <strong>Type:</strong> {{ myTastedDrinkFullInfo?.type }}
                  </p>
                  <p *ngIf="myTastedDrinkFullInfo?.grape">
                    <strong>Grape:</strong> {{ myTastedDrinkFullInfo?.grape }}
                  </p>
                  <p *ngIf="myTastedDrinkFullInfo?.filtration">
                    <strong>Filtration:</strong>
                    {{ myTastedDrinkFullInfo?.filtration }}
                  </p>
                  <p>
                    <strong>Alcohol:</strong>
                    {{ myTastedDrinkFullInfo?.strength }}%
                  </p>
                  <p>
                    <strong>Volume:</strong>
                    {{ myTastedDrinkFullInfo?.volume }} liter
                  </p>
                  <p>
                    <strong>Date of degustation: </strong
                    >{{ tableResult?.dateOfDegustation | date: "yyyy-MM-dd" }}
                  </p>
                  <p><strong>My rating: </strong>{{ tableResult?.rating }}</p>
                  <p>
                    <strong>My feedback: </strong> {{ tableResult?.feedBack }}
                  </p>

                  <div *ngIf="isEdit">
                    <mat-form-field
                      appearance="outline"
                      class="example-form-field"
                    >
                      <mat-label>Choose a date</mat-label>
                      <input
                        matInput
                        [min]="minDate"
                        [max]="maxDate"
                        [matDatepicker]="datepicker"
                        (dateChange)="onChangeEvent($event)"
                        disabled
                      />
                      <mat-datepicker-toggle
                        [disabled]="false"
                        matSuffix
                        [for]="datepicker"
                      ></mat-datepicker-toggle>
                      <mat-datepicker #datepicker [disabled]="false">
                        <mat-datepicker-actions>
                          <button mat-button matDatepickerCancel>Cancel</button>
                          <button
                            mat-raised-button
                            color="primary"
                            matDatepickerApply
                          >
                            Apply
                          </button>
                        </mat-datepicker-actions>
                      </mat-datepicker>
                    </mat-form-field>

                    <ngb-rating
                      [readonly]="false"
                      [resettable]="false"
                      (rateChange)="onRateChange($event)"
                    ></ngb-rating>

                    <form #feedBackForm="ngForm">
                      <mat-form-field appearance="outline">
                        <mat-label>Leave a comment</mat-label>
                        <textarea
                          matInput
                          [(ngModel)]="addUpdateFeedBackModel.feedBack"
                          rows="2"
                          required
                          [(ngModel)]="defaultValue"
                        >
                        </textarea>
                        <mat-error class="mat-error" *ngIf="!isAdd && isEdit">
                          Field are empty, please entry feed back
                        </mat-error>
                      </mat-form-field>

                      <button
                        class="button-edit-check"
                        mat-raised-button
                        (click)="update()"
                        *ngIf="isEdit"
                      >
                        Save
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <button
            class="button-edit"
            mat-raised-button
            color="accent"
            (click)="onEdit()"
            *ngIf="!isAdd && !isEdit"
          >
            Edit
          </button>
          <button
            class="button-back"
            mat-raised-button
            *ngIf="!isAdd || isEdit"
            (click)="backToMyDrinks()"
            (click)="modal.close('Save click')"
          >
            Back
          </button>
        </ng-template>
      </button>
    </div>
  </div>
</div>
